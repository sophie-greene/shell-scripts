#!/bin/bash
m4afile=$1;

    OUTF=$(echo "$m4afile" | sed s/\.m4a/.ogg/g)

    ARTIST=$(faad -i "$m4afile" 2>&1 | grep '^artist: ' | sed 's/^artist: //')
    TITLE=$(faad -i "$m4afile" 2>&1 | grep '^title: ' | sed 's/^title: //')
    ALBUM=$(faad -i "$m4afile" 2>&1 | grep '^album: ' | sed 's/^album: //')
    GENRE=$(faad -i "$m4afile" 2>&1 | grep '^genre: ' | sed 's/^genre: //')
    TRACKNUMBER=$(faad -i "$m4afile" 2>&1 | grep '^track: ' | sed 's/^track: //')
    DATE=$(faad -i "$m4afile" 2>&1 | grep '^date: ' | sed 's/^date: //')

    faad "$m4afile"
    oggenc -q 6 -d "$DATE" -t "$TITLE" -N "$TRACKNUMBER" -a "$ARTIST" -l "$ALBUM" -G "$GENRE" "${m4afile%.*}.mp3"
    #rm "${m4afile%.*}.mp3"
  done
